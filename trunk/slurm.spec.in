# $Id$

Name: @PROJECT@
Version: @VERSION@
Release: @RELEASE@

Summary: Simple Linux Utility for Resource Management

License: GPL 
Group: System Environment/Base
Source: %{name}-%{version}-%{release}.tgz
Requires: readline popt
BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}

%define _with_authd 1
%define _with_elan 0
%define _with_totalview 1

%package devel
Summary: Development package for SLURM.
Group: System Environment/Base
Requires: slurm


%description 
The common slurm package, which includes the base libraries, client
utilitues for SLURM, slurmd, and slurmctld.  Slurmd  is the compute node
daemon of Slurm. It monitors all tasks running on the compute node ,
accepts work (tasks), launches tasks, and kills running tasks upon
request.  Slurmctld  is  the central management daemon of Slurm. It
monitors all other Slurm daemons and resources, accepts work (jobs),
and allocates resources to those jobs.

%description devel
Development package for SLURM.  This package includes the header files
and static libraries.


%prep
%setup -n %{name}-%{version}-%{release}

%build
%if %{_with_elan}
	WITH_ELAN=--with-elan
%endif
%if %{_with_authd}
	WITH_AUTHD=--with-authd
%endif
%if %{_with_totalview}
	WITH_TOTALVIEW=--with-totalview
%endif


./configure --prefix=%{_prefix} --mandir=%{_mandir} --bindir=%{_bindir} \
            --sbindir=%{_sbindir} --libdir=%{_libdir}                   \
            --with-slurm-conf=/etc/slurm --enable-debug                 \
            $WITH_ELAN $WITH_AUTHD $WITH_TOTALVIEW
make

%install
rm -rf "$RPM_BUILD_ROOT"
mkdir -p "$RPM_BUILD_ROOT"
DESTDIR="$RPM_BUILD_ROOT" make install

install -D -m755 etc/init.d.slurm $RPM_BUILD_ROOT/etc/rc.d/init.d/slurm
install -D -m644 etc/slurm.conf.example $RPM_BUILD_ROOT/etc/slurm/slurm.conf

%clean
rm -rf $RPM_BUILD_ROOT

%files
%defattr(-,root,root,0755)
%doc README 
%doc DISCLAIMER
%doc COPYING
%{_bindir}/*
%{_sbindir}/*
%{_libdir}/*.so*
%{_mandir}/man1/*
%{_mandir}/man5/*
%{_mandir}/man8/*
%config(replace) /etc/rc.d/init.d/slurm
%config(noreplace) /etc/slurm/slurm.conf

%files devel
%defattr(-,root,root)
%{_prefix}/include/slurm/*
%{_libdir}/libslurm.a
%{_libdir}/libslurm.la
%{_mandir}/man3/*

%pre
if [ -x /etc/rc.d/init.d/slurm ]; then
	if /etc/rc.d/init.d/slurm status | grep running >/dev/null 2>&1; then
		/etc/rc.d/init.d/slurm stop
	fi
fi

%post
/sbin/ldconfig %{_libdir}
if [ -x /etc/rc.d/init.d/slurm ]; then
	[ -x /sbin/chkconfig ] && /sbin/chkconfig --del slurm
	[ -x /sbin/chkconfig ] && /sbin/chkconfig --add slurm
	if ! /etc/rc.d/init.d/slurm status | grep running >/dev/null 2>&1; then
		/etc/rc.d/init.d/slurm start
	fi
fi

%preun
if [ "$1" = 0 ]; then
	if [ -x /etc/rc.d/init.d/slurm ]; then
		[ -x /sbin/chkconfig ] && /sbin/chkconfig --del slurm
		if /etc/rc.d/init.d/slurm status | grep running >/dev/null 2>&1; then
			/etc/rc.d/init.d/slurm stop
		fi
	fi
fi


%changelog
* Sat Jan 26 2003 Joey Ekstrom <jcekstrom@llnl.gov> 
- Started spec file
-
