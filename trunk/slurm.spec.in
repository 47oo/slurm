Name: @PROJECT@
Version: @VERSION@
Release: @RELEASE@
Summary: Simple Linux Utility for Resource Management
License: GPL - Copyright (C) 2002 The Regents of the University of California.  Produced at Lawrence Livermore National Laboratory (cf, DISCLAIMER).  UCRL-CODE-2002-040.
Group: System Environment/Base
Source: %{name}-%{version}-%{release}.tgz
Requires: authd libreadline libpopt
BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}

%define _with_authd 0
%define _with_elan 0
%define _with_totalview 0


%package devel
Summary: Devel package for SLURM.
Group: System Environment/Base
Requires: slurm


%description 
The common slurm package, which includes the base libraries, client utilitues for SLURM, slurmd, and slurmctld.
Slurmd  is the compute node daemon of Slurm. It monitors all tasks running on the compute node , accepts work (tasks), launches tasks, and kills running tasks upon request.
Slurmctld  is  the central management daemon of Slurm. It monitors all other Slurm daemons and resources, accepts work (jobs), and allocates resources to those jobs.

%description devel
Development package for SLURM.  This package includes the header files and static libraries.


%prep
%setup -n %{name}-%{version}-%{release}

%build
%if %{_with_elan}
	WITH_ELAN=--with-elan
%endif
%if %{_with_authd}
	WITH_AUTHD=--with-authd
%endif
%if %{_with_totalview}
	WITH_TOTALVIEW=--with-totalview
%endif


./configure --prefix=%{_prefix} --mandir=%{_mandir} --bindir=%{_bindir} --sbindir=%{_sbindir} --libdir=%{_libdir} --with-slurm-conf=/etc/slurm $WITHELAN $WITH_ELAN $WITH_AUTHD $WITH_TOTALVIEW
make

%install

DESTDIR="$RPM_BUILD_ROOT" make install

install -D -m755 etc/init.d.slurm $RPM_BUILD_ROOT/etc/rc.d/init.d/slurm
install -D -m755 etc/slurm.conf.example $RPM_BUILD_ROOT/etc/slurm.conf

%clean
rm -rf $RPM_BUILD_ROOT

%files
# where does slurm.conf belong ??? Or should be throw it in the doc directory?
%defattr(-,root,root)
%doc README 
%doc DISCLAIMER
%doc COPYING
%attr(755, root, root) %{_bindir}/*
%attr(755, root, root) %{_sbindir}/*
%config(noreplace) %attr(755, root, root) /etc/rc.d/init.d/slurm
%config(noreplace) %attr(755, root, root) /etc/slurm.conf
%{_libdir}/*.so*
%{_mandir}/man1/*
%{_mandir}/man5/*
%{_mandir}/man8/*

%files devel
%defattr(-,root,root)
%{_prefix}/include/slurm/*
%{_libdir}/libslurm.a
%{_libdir}/libslurm.la
%{_mandir}/man3/*

%pre
if [ -x /etc/rc.d/init.d/slurm ]; then
	if /etc/rc.d/init.d/slurm status | grep running >/dev/null 2>&1; then
		/etc/rc.d/init.d/slurm stop
	fi
fi

%post
ldconfig %{_libdir}
if [ -x /etc/rc.d/init.d/slurm ]; then
	[ -x /sbin/chkconfig ] && /sbin/chkconfig --del slurm
	[ -x /sbin/chkconfig ] && /sbin/chkconfig --add slurm
	if ! /etc/rc.d/init.d/slurm status | grep running >/dev/null 2>&1; then
		/etc/rc.d/init.d/slurm start
	fi
fi

%preun
if [ "$1" = 0 ]; then
	if [ -x /etc/rc.d/init.d/slurm ]; then
		[ -x /sbin/chkconfig ] && /sbin/chkconfig --del slurm
		if /etc/rc.d/init.d/slurm status | grep running >/dev/null 2>&1; then
			/etc/rc.d/init.d/slurm stop
		fi
	fi
fi


%changelog
* Sat Jan 26 2003 Joey Ekstrom <jcekstrom@llnl.gov> 
- Started spec file
-
