############################################################################
# Copyright (C) 2002-2006 The Regents of the University of California.
# Produced at Lawrence Livermore National Laboratory (cf, DISCLAIMER).
# Written by Morris Jette <jette1@llnl.gov>
############################################################################

This directory contains a battery of Moab regression tests. Some tests are
dependent upon having a Slurm resource manager.

The tests make use of the "expect" scripting language. You can create 
"globals.local" and identify locations of files to be used in testing, 
especially the variable "moab_dir", which is the installation directory 
of Moab to be used for testing.  These tests expect single node jobs 
submitted to the default partition to respond within a two minutes.  
If that is not the case, modify the value of "max_job_delay" in the 
"globals.local" file to an appropriate value or the tests will report 
failures due to timeouts.  If there are file propagation delays (e.g. 
due to NFS), the value of "max_file_delay" in the "globals.local" file 
may also need modification.

Each test can be executed independently. Upon successful completion, the test 
will print "SUCCESS" and terminate with an exit code of zero. Upon failure, 
the test will typically print "FAILURE" and an explanation of the failure. 
The message "WARNING" indicates that the cluster configuration can not fully 
test some option (e.g. only one node or partition) and the test terminates with 
an exit code of zero. In the event of a configuration problem or other 
catastrophic test failure other messages could be printed and their cause 
should be investigated. In either case, failing tests will terminate with a 
non-zero exit code and successful tests will terminate with a zero exit code.

The script "regression" or "regression.py" (Python version) will execute all 
of the tests and summarize the results. regression.py contains some filtering
options. A summary of each test is shown below.

There are also scripts to emulate some commands on systems lacking them (e.g. 
AIX). These include pkill and usleep.

############################################################################


test1.#    Testing of msub command.
===================================
test1.1    msub --help
test1.2    msub --version
test1.3    msub -e <errorpath> -o <outputpath>
test1.4    Confirm the job runs with the proper user and group ID
test1.5    msub -l walltime=secs (time limit)
test1.6    msub --about
test1.7    msub --loglevel=#
test1.8    msub -d path (working directory)
test1.9    msub -a (eligible start time)
test1.10   msub -A <account>
test1.11   msub -j (option to merge stdout and stderr)
test1.12   msub -h (option to hold job)
test1.13   msub -m (mail option)
test1.14   msub -N (job name option)
test1.15   msub -p (job priority option)
test1.16   msub -V -v <env>  (environment variable propagation)
test1.17   msub -l nodes=# (resource specification)
test1.18   msub -l ppn=# (resource specification)
test1.19   msub -l depend (job dependency)
test1.20   Build script from stdin


test2.#    Testing of checkjob command.
=======================================
Extensively tested in many of the other tests


test3.#    Testing of canceljob command.
========================================
test3.1    Cancelation of pending jobs
test3.2    Cancelation of running jobs
test3.3    Cancelation of terminated jobs
test3.4    canceljob --help


test4.# to test39.# Reserved for Moab command tests.
====================================================


test40.#   Testing of psub command.
===================================
test40.1   psub -H   (help)
test40.2   psub -e <errorpath> -o <outputpath>
test40.3   psub -tW  (wall time limit)
test40.4   psub -mb -me (mail option)
test40.5   psub -r  (job name option)
test40.6   psub -b <bank_account>
test40.7   psub -d  (job dependency)
test40.8   psub -eo (option to merge stdout and stderr)
test40.9   psub -A  (eligible start time)
test40.10  psub -pool <partition_name>
test40.11  psub -tM  (CPU time limit)
test40.12  psub -ln  (node count)
test40.13  psub -i  (invoke command, not a shell)
test40.14  Test for LCRM environment variables set in spawned shell


test41.# to test59.# Reserved for LCRM command tests.
=====================================================


test90.#   Stress tests.
========================
test90.1   Submit many simultaneous jobs
test90.2   Stress test multiple simultaneous commands via multiple threads

